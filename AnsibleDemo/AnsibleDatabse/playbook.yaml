-
  name: Deploy a web application
  hosts: target1
  tasks:
    - name: ping check
      ping:

    - name: Install Python
      become: true
      become_method: sudo
      apt: name={{ item }} state=installed
      with_items:
        - python
        - python-setuptools
        - python-dev
        - build-essential
        - python-pip
        - python-mysqldb
        - python-pymysql

    - name: Install Mysql Database
      become: true
      become_method: sudo
      apt: name={{ item }} state=installed
      with_items:
        - mysql-server
        - mysql-client

    - name: Start  Mysql Service
      service:
        name: mysql
        state: started
        enabled: yes

    - name: Create the mysql database
      become: true
      become_method: sudo
      mysql_db:
        name: AnsibleDemo1
        state: present

    - name: Create the database user
      mysql_user:
        name: dbuser
        password: 12345db
        priv: '*.*:ALL'
        state: present

    - name: Install Python dependency
      pip: name={{ item }} state=present
      with_items:
        - flask
        - flask-mysql

    - name: Copy the Source code
      copy: src=app.py dest=/opt/app.py

    - name: Start the web server
      shell: FLASK_APP=app.py nohup flask run --host=0.0.0.0











